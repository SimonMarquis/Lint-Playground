<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Android Lint SARIF Viewer</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' height='24px' viewBox='0 -960 960 960' width='24px' fill='%233ddc84'%3E%3Cpath d='M480-200q66 0 113-47t47-113v-160q0-66-47-113t-113-47q-66 0-113 47t-47 113v160q0 66 47 113t113 47Zm-80-120h160v-80H400v80Zm0-160h160v-80H400v80Zm80 40Zm0 320q-65 0-120.5-32T272-240H160v-80h84q-3-20-3.5-40t-.5-40h-80v-80h80q0-20 .5-40t3.5-40h-84v-80h112q14-23 31.5-43t40.5-35l-64-66 56-56 86 86q28-9 57-9t57 9l88-86 56 56-66 66q23 15 41.5 34.5T688-640h112v80h-84q3 20 3.5 40t.5 40h80v80h-80q0 20-.5 40t-3.5 40h84v80H688q-32 56-87.5 88T480-120Z'/%3E%3C/svg%3E"/>
    <style>
        :root {
            --primary: #3ddc84;
            --primary-dark: #32b36b;
            --primary-bg: rgba(61, 220, 132, 0.1);
            --bg-body: #121212;
            --bg-surface: #1e1e1e;
            --bg-elevation: #2d2d2d;
            --text-main: #ffffff;
            --text-secondary: #a0a0a0;
            --text-tertiary: #666666;
            --border: #333333;
            --code-bg: #171717;
            --code-text: #d4d4d4;
            --code-border: #333333;
            --severity-fatal: #d32f2f;
            --severity-error: #ef5350;
            --severity-warning: #ffca28;
            --severity-info: #42a5f5;
            --severity-ignore: #78909c;
        }

        [data-theme="light"] {
            --primary: #00875A;
            --primary-dark: #006c4c;
            --primary-bg: rgba(0, 135, 90, 0.08);
            --bg-body: #e4e7eb;
            --bg-surface: #ffffff;
            --bg-elevation: #f1f5f9;
            --text-main: #1f1f1f;
            --text-secondary: #4b5563;
            --text-tertiary: #6b7280;
            --border: #cdd5df;
            --code-bg: #f6f8fa;
            --code-text: #24292e;
            --code-border: #e1e4e8;
            --severity-fatal: #b71c1c;
            --severity-error: #d32f2f;
            --severity-warning: #ea580c;
            --severity-info: #0284c7;
            --severity-ignore: #90a4ae;
        }

        html {
            scrollbar-gutter: stable;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            line-height: 1.6;
            min-height: 100vh;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        header {
            background-color: var(--bg-surface);
            border-bottom: 1px solid var(--border);
            padding: 1rem 2rem;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            position: sticky;
            top: 0;
            z-index: 50;
            transition: background-color 0.3s ease, border-color 0.3s ease;
            gap: 1rem;
        }

        h1 {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-main);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            white-space: nowrap;
            overflow: hidden; text-overflow: ellipsis;
            min-width: 0;
            flex: 0 1 auto;
            user-select: none;
        }

        h1 svg { flex-shrink: 0; }
        h1 span { color: var(--primary); }

        .status-badge {
            font-size: 0.75rem;
            background-color: var(--bg-elevation);
            border: 1px solid var(--border);
            color: var(--text-secondary);
            padding: 0.2rem 0.6rem;
            border-radius: 12px;
            font-weight: 500;
            letter-spacing: 0.05em;
            text-transform: uppercase;
            flex-shrink: 0;
            margin-right: auto;
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-shrink: 0;
        }

        #report-info {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            justify-content: center;
            margin-right: 0.5rem;
            text-align: right;
            line-height: 1.3;
            max-width: 250px;
            min-height: 3.2rem;
        }

        .info-line-primary {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-main);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            width: 100%;
        }

        .info-line-secondary {
            font-size: 0.7rem;
            color: var(--text-secondary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            width: 100%;
        }

        .info-line-tertiary {
            font-size: 0.65rem;
            color: var(--text-tertiary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            width: 100%;
        }

        @media (max-width: 768px) {
            .status-badge { display: none; }
            #report-info { max-width: 150px; }
        }

        @media (max-width: 480px) {
            header { padding: 0.75rem 1rem; }
            h1 { font-size: 1rem; }
            h1 > span { display: none; }
            .header-controls { gap: 0.5rem; }
            #report-info { display: none; }
        }

        .theme-toggle {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0.5rem;
            border-radius: 50%;
            transition: color 0.2s ease, background-color 0.2s ease;
        }

        .theme-toggle:hover {
            color: var(--text-main);
            background-color: var(--bg-elevation);
        }

        .header-link {
            color: var(--text-secondary);
            padding: 0.5rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: color 0.2s ease, background-color 0.2s ease;
            text-decoration: none;
        }

        .header-link:hover {
            color: var(--text-main);
            background-color: var(--bg-elevation);
        }

        main {
            padding: 2rem;
            width: 100%;
            max-width: 100%;
        }

        #drop-zone {
            border: 2px dashed var(--border);
            border-radius: 12px;
            padding: 4rem 2rem;
            text-align: center;
            background-color: var(--bg-surface);
            transition: all 0.2s ease;
            cursor: pointer;
            margin-bottom: 2rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
        }

        #drop-zone:hover {
            border-color: var(--text-secondary);
            background-color: var(--bg-elevation);
        }

        #drop-zone.highlight {
            border-color: var(--primary);
            background-color: var(--primary-bg);
        }

        #drop-zone > svg {
            width: 48px;
            height: 48px;
            margin-bottom: 1rem;
            stroke: var(--text-secondary);
        }

        .drop-text-main {
            font-size: 1.2rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
        }

        .or-separator {
            display: flex;
            align-items: center;
            width: 100%;
            max-width: 280px;
            margin: 1rem 0;
            color: var(--text-tertiary);
            font-size: 0.8rem;
            user-select: none;
        }

        .or-separator::before, .or-separator::after {
            content: "";
            flex: 1;
            height: 1px;
            background: var(--border);
        }

        .or-separator span {
            padding: 0 1rem;
        }

        .drop-actions {
            font-size: 0.85rem;
            color: var(--text-secondary);
            text-decoration: underline dotted;
            text-underline-offset: 3px;
            transition: color 0.2s ease;
            user-select: none;
            cursor: pointer;
            display: inline-block;
        }

        .drop-actions:hover {
            color: var(--primary);
            text-decoration-style: solid;
        }

        .drop-actions strong {
            font-weight: 700;
        }

        #results-container {
            display: none;
            max-width: 1200px;
            margin: 0 auto;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .metric-card {
            background-color: var(--bg-surface);
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid var(--border);
            transition: box-shadow 0.2s ease, border-color 0.2s ease;
        }

        .metric-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            border-color: var(--text-tertiary);
        }

        .metric-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-main);
        }

        .metric-label {
            color: var(--text-secondary);
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .filter-section {
            background-color: var(--bg-surface);
            padding: 1.5rem;
            border-radius: 8px;
            border: 1px solid var(--border);
            margin-bottom: 1.5rem;
            transition: box-shadow 0.2s ease, border-color 0.2s ease;
        }

        .filter-section:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            border-color: var(--text-tertiary);
        }

        .search-row {
            margin-bottom: 1.5rem;
            position: relative;
            display: flex;
            align-items: center;
        }

        .filter-input {
            width: 100%;
            background-color: var(--bg-body);
            border: 1px solid var(--border);
            color: var(--text-main);
            padding: 0.75rem 0.75rem 0.75rem 40px;
            border-radius: 6px;
            font-size: 1rem;
        }

        .filter-input:focus {
            outline: none;
            border-color: var(--text-tertiary);
            box-shadow: 0 0 0 1px var(--text-tertiary);
        }

        .search-icon {
            position: absolute;
            left: 12px;
            color: var(--text-secondary);
            pointer-events: none;
            display: flex;
            align-items: center;
        }

        .search-hint {
            position: absolute;
            left: 40px;
            font-size: 0.95rem;
            color: var(--text-secondary);
            pointer-events: none;
            user-select: none;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: opacity 0.1s ease;
        }

        kbd {
            background-color: var(--bg-elevation);
            border: 1px solid var(--border);
            border-radius: 4px;
            padding: 1px 6px;
            font-family: inherit;
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.2;
            box-shadow: 0 1px 0 var(--border);
        }

        .filter-group {
            display: flex;
            align-items: flex-start;
            gap: 1.5rem;
            margin-bottom: 1rem;
        }

        .filter-group:last-child {
            margin-bottom: 0;
        }

        .filter-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-weight: 600;
            min-width: 80px;
            white-space: nowrap;
            flex-shrink: 0;
            height: 32px;
            display: flex;
            align-items: center;
        }

        .pills-container {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            flex: 1;
        }

        .pill {
            appearance: none;
            font-family: inherit;
            background-color: var(--bg-elevation);
            color: var(--text-secondary);
            border: 1px solid transparent;
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: background-color 0.2s ease, border-color 0.2s ease, color 0.2s ease;
            user-select: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: fit-content;
            line-height: 1.2;
        }

        .pill:hover {
            background-color: var(--border);
            color: var(--text-main);
        }

        .pill:focus {
            outline: 2px solid var(--text-tertiary);
            outline-offset: 2px;
        }

        .pill.active {
            background-color: var(--primary-bg);
            color: var(--primary);
            border-color: var(--primary);
            text-shadow: 0 0 0.65px currentColor;
            font-weight: normal;
        }

        .pill[data-severity="error"].active {
            background-color: rgba(239, 83, 80, 0.15);
            color: var(--severity-error);
            border-color: var(--severity-error);
        }
        .pill[data-severity="warning"].active {
            background-color: rgba(255, 202, 40, 0.15);
            color: var(--severity-warning);
            border-color: var(--severity-warning);
        }
        .pill[data-severity="info"].active {
            background-color: rgba(66, 165, 245, 0.15);
            color: var(--severity-info);
            border-color: var(--severity-info);
        }

        .issue-list {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .issue-group {
            background-color: var(--bg-surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
            content-visibility: auto;
            contain-intrinsic-size: 150px;
            transition: box-shadow 0.2s ease, border-color 0.2s ease;
        }

        .issue-group:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            border-color: var(--text-tertiary);
        }

        .issue-group-header {
            background-color: var(--bg-elevation);
            padding: 1rem 1.25rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .issue-group-title {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-family: monospace;
            font-weight: 700;
            color: var(--primary);
            font-size: 1.1rem;
        }

        .issue-group-count {
            background-color: var(--bg-body);
            color: var(--text-secondary);
            padding: 0.1rem 0.6rem;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            border: 1px solid var(--border);
        }

        .issue-group-content {
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
        }

        .issue-card {
            background-color: var(--bg-body);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1rem;
            transition: transform 0.1s ease;
        }

        .issue-card:hover {
            border-color: var(--text-tertiary);
        }

        .categories-wrapper {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            justify-content: flex-end;
            max-width: 50%;
        }

        .category-badge {
            background-color: var(--bg-surface);
            border: 1px solid var(--border);
            color: var(--text-secondary);
            padding: 0.2rem 0.6rem;
            border-radius: 100px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .severity-badge {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
            flex-shrink: 0;
            margin-top: 0.5rem;
        }

        .issue-group-title .severity-badge {
            margin-top: 0;
            width: 12px;
            height: 12px;
        }

        .severity-error {
            background-color: var(--severity-error);
            box-shadow: 0 0 6px var(--severity-error);
            opacity: 0.9;
        }
        .severity-warning {
            background-color: var(--severity-warning);
            box-shadow: 0 0 6px var(--severity-warning);
            opacity: 0.9;
        }
        .severity-info {
            background-color: var(--severity-info);
            box-shadow: 0 0 6px var(--severity-info);
            opacity: 0.9;
        }

        .issue-message {
            font-size: 1rem;
            margin-bottom: 0.75rem;
            color: var(--text-main);
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
        }

        .issue-location {
            appearance: none;
            background: none;
            background-color: var(--bg-surface);
            padding: 0.5rem 0.75rem;
            border-radius: 6px;
            font-family: monospace;
            font-size: 0.85rem;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 0;
            text-decoration: none;
            border: 1px solid transparent;
            transition: all 0.2s ease;
            cursor: pointer;
            width: 100%;
            text-align: left;
            overflow: hidden;
        }

        .path-dir {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            min-width: 0;
            flex-shrink: 1;
            color: var(--text-tertiary);
            direction: ltr;
        }

        .path-name {
            white-space: nowrap;
            flex-shrink: 0;
            color: var(--text-secondary);
            font-weight: 600;
        }

        .line-number {
            color: var(--text-tertiary);
            white-space: nowrap;
            flex-shrink: 0;
        }

        .issue-location:hover {
            border-color: var(--text-tertiary);
            color: var(--text-main);
            background-color: var(--bg-elevation);
        }

        .issue-location:focus {
            outline: 2px solid var(--text-tertiary);
            outline-offset: 2px;
            border-color: var(--text-tertiary);
        }

        .issue-code-snippet {
            margin-top: 0.8rem;
            background-color: var(--code-bg);
            border: 1px solid var(--code-border);
            border-radius: 6px;
            padding: 0.75rem;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 0.85rem;
            overflow-x: auto;
            line-height: 1.4;
        }

        .code-line {
            display: flex;
            gap: 1rem;
            min-width: fit-content;
        }

        .code-line-number {
            color: var(--text-tertiary);
            min-width: 3ch;
            text-align: right;
            user-select: none;
            border-right: 1px solid var(--border);
            padding-right: 0.75rem;
            flex-shrink: 0;
        }

        .code-content {
            color: var(--code-text);
            white-space: pre;
        }

        .code-highlight {
            text-decoration: underline;
            text-decoration-style: wavy;
            text-decoration-color: var(--severity-error);
            text-decoration-thickness: 1.5px;
            background-color: rgba(239, 83, 80, 0.1);
        }

        .hidden { display: none !important; }

        .toast {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            padding: 1rem 2rem;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.5);
            z-index: 100;
            animation: slideIn 0.3s ease;
            font-weight: 500;
            border: 1px solid transparent;
        }

        .toast-error {
            background-color: #3e2727;
            color: #ff8a80;
            border-color: #ff5252;
        }

        .toast-info {
            background-color: var(--bg-elevation);
            color: var(--text-main);
            border-color: var(--primary);
        }

        @keyframes slideIn {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-secondary);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .empty-state-title {
            font-weight: 600;
            font-size: 1.1rem;
            color: var(--text-secondary);
            margin-top: 0.5rem;
        }

        .empty-state-subtitle {
            font-size: 0.9rem;
            color: var(--text-tertiary);
        }

        .empty-state svg {
            color: var(--text-secondary);
        }

        .reset-btn {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-secondary);
            padding: 0.5rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: color 0.2s ease, background-color 0.2s ease;
        }

        .reset-btn:hover {
            color: var(--text-main);
            background-color: var(--bg-elevation);
        }

        #drag-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(18, 18, 18, 0.9);
            z-index: 9999;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(4px);
            border: 4px dashed var(--primary);
            color: var(--primary);
        }

        [data-theme="light"] #drag-overlay {
            background-color: rgba(255, 255, 255, 0.9);
        }

        #drag-overlay svg {
            width: 64px;
            height: 64px;
            stroke: var(--primary);
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>

<header>
    <h1>
        <svg width="28" height="28" viewBox="0 0 24 24" fill="currentColor" style="color:var(--primary)">
            <path d="M20 8h-2.81c-.45-.78-1.07-1.45-1.82-1.96L17 4.41 15.59 3l-2.17 2.17C12.96 5.06 12.49 5 12 5c-.49 0-.96.06-1.41.17L8.41 3 7 4.41l1.62 1.63C7.88 6.55 7.26 7.22 6.81 8H4v2h2.09c-.05.33-.09.66-.09 1v1H4v2h2v1c0 .34.04.67.09 1H4v2h2.81c1.04 1.79 2.97 3 5.19 3s4.15-1.21 5.19-3H20v-2h-2.09c.05-.33.09-.66.09-1v-1h2v-2h-2v-1c0-.34-.04-.67-.09-1H20V8zm-6 8h-4v-2h4v2zm0-4h-4v-2h4v2z"/>
        </svg>
        Android Lint <span>SARIF Viewer</span>
    </h1>
    <span class="status-badge">ðŸš§ Work in Progress ðŸš§</span>
    <div class="header-controls">
        <div id="report-info"></div>

        <button id="reset-button" class="reset-btn hidden" title="Load New File">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
                <line x1="12" y1="11" x2="12" y2="17"></line>
                <line x1="9" y1="14" x2="15" y2="14"></line>
            </svg>
        </button>
        <button id="theme-toggle" class="theme-toggle" title="Toggle Theme"></button>
        <a href="https://github.com/SimonMarquis/Lint-Playground?utm_source=sarif-viewer" target="_blank" rel="noopener noreferrer" class="header-link" title="View on GitHub">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
            </svg>
        </a>
    </div>
</header>

<main>
    <div id="drop-zone">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
            <line x1="12" y1="11" x2="12" y2="17"></line>
            <line x1="9" y1="14" x2="15" y2="14"></line>
        </svg>
        <div class="drop-text-main">Drop your SARIF file here</div>

        <div class="or-separator">
            <span>or</span>
        </div>

        <div class="drop-actions" id="load-example-wrapper">
            load report from <strong>android/nowinandroid</strong> project
        </div>
        <input type="file" id="file-input" accept=".sarif,.json" style="display:none">
    </div>

    <div id="results-container">
        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-value" id="metric-total">0</div>
                <div class="metric-label">Total Issues</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" style="color: var(--severity-error)" id="metric-errors">0</div>
                <div class="metric-label">Errors</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" style="color: var(--severity-warning)" id="metric-warnings">0</div>
                <div class="metric-label">Warnings</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" style="color: var(--severity-info)" id="metric-info">0</div>
                <div class="metric-label">Hints</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="metric-categories">0</div>
                <div class="metric-label">Categories</div>
            </div>
        </div>

        <div class="filter-section">
            <div class="search-row">
                <div class="search-icon">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="11" cy="11" r="8"></circle>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    </svg>
                </div>
                <input type="text" id="filter-text" class="filter-input">
                <span class="search-hint" id="search-hint">Type <kbd>/</kbd> to search</span>
            </div>
            <div class="filter-group">
                <div class="filter-label">Severity</div>
                <div class="pills-container" id="severity-pills">
                    <button class="pill active" data-value="all">All</button>
                    <button class="pill" data-value="error" data-severity="error">Error</button>
                    <button class="pill" data-value="warning" data-severity="warning">Warning</button>
                    <button class="pill" data-value="info" data-severity="info">Information</button>
                </div>
            </div>
            <div class="filter-group">
                <div class="filter-label">Category</div>
                <div class="pills-container" id="category-pills">
                    <button class="pill active" data-value="all">All</button>
                </div>
            </div>
            <div class="filter-group">
                <div class="filter-label">Issue ID</div>
                <div class="pills-container" id="issue-id-pills">
                    <button class="pill active" data-value="all">All</button>
                </div>
            </div>
        </div>

        <div id="issue-list" class="issue-list"></div>
        <div id="empty-filter-state" class="empty-state hidden">
            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="11" cy="11" r="8"></circle>
                <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                <line x1="8" y1="11" x2="14" y2="11"></line>
            </svg>
            <span class="empty-state-title">No matching issues found!</span>
            <span class="empty-state-subtitle">Try adjusting your filters or search query.</span>
        </div>
    </div>
</main>

<div id="toast" class="toast hidden"></div>

<div id="drag-overlay" class="hidden">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
        <line x1="12" y1="11" x2="12" y2="17"></line>
        <line x1="9" y1="14" x2="15" y2="14"></line>
    </svg>
    <h2 style="font-size: 1.5rem; font-weight: 600;">Drop to Load New File</h2>
</div>

<script id="sarif-example" data-src="lint-results-demoDebug.sarif" type="application/json"></script>
<!--<script id="sarif-example" type="application/gzip+base64">H4sICJmRi2kAA3NtYWxsLnNhcmlmAMVVTW/bMAz9K4IwoIel9up2wJqlWbvusAIdMDTdaRkCxWJsDbZkSHTSrMh/H2U7qfPdw4A5h+iDfHokn6hn/sbFKeSCd3mKWLhuGFoxCxKFaTkuHdjYaASNQWzy0Ain3CnGLnTCqsmpKyAOc+EQbDioYFAst6rpaRScBe+C385o3uFTsE7RqMurZVqxpXa8+/OZozEZ7z5zaRVZ+ZEWOZDljZbWKMnulcY1iA9B1EBkUGMoSctfhZWxkSAf4ck7uNRY/AIutqrAypMO81stU1YtLDpcwkSUGd4aPVFJacXSIYMpED0O1hrrDQtrCrCo/MmEJxLPgN8aayFGDc7RyXeUN6srDJGpPzXYr8Wi0zD9oSm98gGcKW0M7jDX2pjZlfUr2M6E1Uon+/l+BzsxNhc6hjaxx3lhjtAZFJBlhM1WGTlGRhuE12WOmHgynGIlwLq0vsh3u8qbk4dIYGdVHVpPccgH5ThXOOQdRiGVmWSUS3bdbC9T6smt15nmJq4CqUkU6dypWGT3zao/VFAoExFje620ijBEUYTO+uuhdEiHhJmYmxJDMlZThfOR3wie8oxXsSaNs0OCJLFTSGfvO/X01mRlTrvReYeDli+7NFntXRJMdVef8GEnWkRoWhUFYCtbjL7e5xLR6KFmzSfqO9dV8mrIr98qGboqg6Nxbci3TevgRjMlMSWnmRXFqOkcu8z96VcvhdmLl4JKUtwCZGGfLxZeJ52WNrYv1LY6HlNYVZydPAS1CIKych3VsxNGtQNhHUPDxsDqzbY+ljfrHytkKrKS/moW7qA2LjakcXbZksbFmjLOoyPK2C+M5or4Vkw1IL4jPxzy/rc5uymKXkO1X9dv0zz24Y4cIPpwyGvQDA/7rdWCvJrWN6jmh10zkyiSZ//e/69Md0hl2eK2BULtwj85ykiSmXJMMHr4cqNZrpxrut5HJulFIoGyHIRuPEi1Q/6prZKq5f0/iUQbEjmPWhKJ1iVytHnskkhv9RrtEcC6XuqsbuimF76ANHXyv7+XESPqlwgAAA==</script>-->

<script>
    const debounce = (fn, delay) => {
        let timeoutId;
        return (...args) => {
            clearTimeout(timeoutId);
            timeoutId = setTimeout(() => fn(...args), delay);
        };
    };

    async function decodeBase64GzipJson(b64) {
        if (!("DecompressionStream" in window)) {
            showError("DecompressionStream('gzip') not supported in this browser.");
            return null;
        }
        try {
            const cleanB64 = b64.trim();
            const binaryString = atob(cleanB64);
            const bytes = Uint8Array.from(binaryString, c => c.charCodeAt(0));
            const stream = new Blob([bytes]).stream()
                .pipeThrough(new DecompressionStream("gzip"));
            const text = await new Response(stream).text();
            return JSON.parse(text);
        } catch (err) {
            console.error("Decompression failed", err);
            showError("Failed to decompress example file: " + err.message);
            return null;
        }
    }

    async function copyToClipboard(text) {
        try {
            await navigator.clipboard.writeText(text);
            showToast(`Path copied to clipboard!`, false);
        } catch (err) {
            console.error('Failed to copy: ', err);
            showToast('Failed to copy to clipboard', true);
        }
    }

    const toast = document.getElementById('toast');
    function showToast(msg, isError = false) {
        toast.textContent = msg;
        toast.className = 'toast';
        if (isError) toast.classList.add('toast-error');
        else toast.classList.add('toast-info');
        toast.classList.remove('hidden');
        setTimeout(() => toast.classList.add('hidden'), 3000);
    }

    function showError(msg) { showToast(msg, true); }

    function sanitize(str) {
        if (!str) return '';
        const div = document.createElement('div');
        div.textContent = str;
        return div.innerHTML;
    }

    const themeToggle = document.getElementById('theme-toggle');
    const iconSun = `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>`;
    const iconMoon = `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>`;

    function initTheme() {
        const savedTheme = localStorage.getItem('theme');
        const systemDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        applyTheme(savedTheme || (systemDark ? 'dark' : 'light'), false);
    }

    function applyTheme(theme, persist = true) {
        document.documentElement.setAttribute('data-theme', theme);
        themeToggle.innerHTML = theme === 'dark' ? iconSun : iconSun;
        if (persist) localStorage.setItem('theme', theme);
    }

    themeToggle.addEventListener('click', () => {
        const currentTheme = document.documentElement.getAttribute('data-theme') || 'dark';
        applyTheme(currentTheme === 'dark' ? 'light' : 'dark', true);
    });

    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
        if (!localStorage.getItem('theme')) applyTheme(e.matches ? 'dark' : 'light', false);
    });

    initTheme();

    const state = {
        rawIssues: [],
        filteredIssues: [],
        categories: new Set(),
        uniqueIssueIds: new Set(),
        filename: '',
        driverInfo: { name: '', version: '' },
        reportDate: null,
        fileLastModified: null,
        filters: {
            text: '',
            categories: new Set(['all']),
            issueIds: new Set(['all']),
            severities: new Set(['all'])
        }
    };

    const dropZone = document.getElementById('drop-zone');
    const fileInput = document.getElementById('file-input');
    const resultsContainer = document.getElementById('results-container');
    const reportInfoContainer = document.getElementById('report-info');
    const resetButton = document.getElementById('reset-button');
    const issueList = document.getElementById('issue-list');
    const emptyFilterState = document.getElementById('empty-filter-state');
    const filterText = document.getElementById('filter-text');
    const searchHint = document.getElementById('search-hint');
    const severityPillsContainer = document.getElementById('severity-pills');
    const categoryPillsContainer = document.getElementById('category-pills');
    const issueIdPillsContainer = document.getElementById('issue-id-pills');
    const dragOverlay = document.getElementById('drag-overlay');
    const exampleLoadWrapper = document.getElementById('load-example-wrapper');
    const metricTotal = document.getElementById('metric-total');
    const metricErrors = document.getElementById('metric-errors');
    const metricWarnings = document.getElementById('metric-warnings');
    const metricInfo = document.getElementById('metric-info');
    const metricCategories = document.getElementById('metric-categories');

    window.addEventListener('keydown', (e) => {
        if (e.key === '/' && document.activeElement !== filterText && resultsContainer.style.display !== 'none') {
            e.preventDefault();
            filterText.focus();
        }
    });

    filterText.addEventListener('focus', () => searchHint.style.opacity = '0');
    filterText.addEventListener('blur', () => {
        if (filterText.value === '') searchHint.style.opacity = '1';
    });

    dropZone.addEventListener('click', (e) => {
        if (e.target.closest('#load-example-wrapper')) return;
        fileInput.click();
    });

    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        dropZone.addEventListener(eventName, e => { e.preventDefault(); e.stopPropagation(); }, false);
    });

    ['dragenter', 'dragover'].forEach(eventName => {
        dropZone.addEventListener(eventName, e => {
            if (e.dataTransfer && Array.from(e.dataTransfer.types).includes('Files')) dropZone.classList.add('highlight');
        }, false);
    });

    ['dragleave', 'drop'].forEach(eventName => {
        dropZone.addEventListener(eventName, () => dropZone.classList.remove('highlight'), false);
    });

    dropZone.addEventListener('drop', e => handleFiles(e.dataTransfer.files));
    fileInput.addEventListener('change', e => handleFiles(e.target.files));
    resetButton.addEventListener('click', () => fileInput.click());

    exampleLoadWrapper.addEventListener('click', async (e) => {
        e.preventDefault();
        e.stopPropagation();
        const el = document.getElementById('sarif-example');
        if (!el) return showError("Example data not found.");

        const src = el.getAttribute('data-src');
        const type = el.getAttribute('type');
        let json = null;

        try {
            if (src) {
                const response = await fetch(src);
                if (!response.ok) throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                json = await response.json();
            } else if (type === 'application/json') {
                json = JSON.parse(el.textContent);
            } else if (type === 'application/gzip+base64') {
                json = await decodeBase64GzipJson(el.textContent);
            } else {
                throw new Error("Unknown example format type.");
            }
        } catch (err) {
            return showError(`Failed to load: ${err.message}`);
        }

        if (json) {
            try {
                resetApp();
                state.filename = src || "Now in Android";
                state.fileLastModified = Date.now();
                processSarif(json);
                showResultsUI();
            } catch (err) {
                showError("Error processing example: " + err.message);
            }
        }
    });

    let dragCounter = 0;
    window.addEventListener('dragenter', e => {
        e.preventDefault();
        if (!e.dataTransfer || !Array.from(e.dataTransfer.types).includes('Files')) return;
        dragCounter++;
        dragOverlay.classList.remove('hidden');
    });

    window.addEventListener('dragleave', e => {
        e.preventDefault();
        if (!e.dataTransfer || !Array.from(e.dataTransfer.types).includes('Files')) return;
        dragCounter--;
        if (dragCounter <= 0) { dragCounter = 0; dragOverlay.classList.add('hidden'); }
    });

    window.addEventListener('dragover', e => e.preventDefault());
    window.addEventListener('drop', e => {
        e.preventDefault();
        dragCounter = 0;
        dragOverlay.classList.add('hidden');
        if (e.dataTransfer && e.dataTransfer.files.length > 0) handleFiles(e.dataTransfer.files);
    });

    issueList.addEventListener('click', e => {
        const btn = e.target.closest('.issue-location');
        if (btn) { e.preventDefault(); const path = btn.getAttribute('data-path'); if (path) copyToClipboard(path); }
    });

    filterText.addEventListener('input', debounce(e => {
        state.filters.text = e.target.value.toLowerCase();
        applyFilters();
    }, 200));

    severityPillsContainer.addEventListener('click', e => handlePillClick(e, 'severities', severityPillsContainer));
    categoryPillsContainer.addEventListener('click', e => handlePillClick(e, 'categories', categoryPillsContainer));
    issueIdPillsContainer.addEventListener('click', e => handlePillClick(e, 'issueIds', issueIdPillsContainer));

    function handlePillClick(e, filterType, container) {
        const target = e.target.closest('.pill');
        if (!target) return;
        const value = target.getAttribute('data-value');
        const filterSet = state.filters[filterType];
        if (value === 'all') {
            filterSet.clear();
            filterSet.add('all');
        } else {
            if (filterSet.has('all')) filterSet.delete('all');
            if (filterSet.has(value)) filterSet.delete(value);
            else filterSet.add(value);
            if (filterSet.size === 0) filterSet.add('all');
        }
        updatePillVisuals(container, filterSet);
        applyFilters();
    }

    function updatePillVisuals(container, filterSet) {
        Array.from(container.children).forEach(pill => {
            if (filterSet.has(pill.getAttribute('data-value'))) pill.classList.add('active');
            else pill.classList.remove('active');
        });
    }

    function handleFiles(files) {
        if (!files || files.length === 0) return;
        const file = files[0];
        const fileName = file.name.toLowerCase();
        if (!fileName.endsWith('.sarif') && !fileName.endsWith('.json')) {
            return showError("Invalid file format. Please use .sarif or .json files.");
        }
        resetApp();
        state.filename = file.name;
        state.fileLastModified = file.lastModified;
        const reader = new FileReader();
        reader.onload = (e) => {
            try {
                processSarif(JSON.parse(e.target.result));
                showResultsUI();
            } catch (err) {
                state.filename = '';
                reportInfoContainer.innerHTML = '';
                showError(err.message || "Could not parse JSON.");
            }
        };
        reader.onerror = () => showError("Error reading file.");
        reader.readAsText(file);
    }

    function processSarif(sarif) {
        if (!sarif?.runs || !Array.isArray(sarif.runs)) throw new Error("Invalid SARIF: Missing 'runs' array.");
        const run = sarif.runs[0] || {};
        const driver = run.tool?.driver || {};
        state.driverInfo = { name: driver.fullName || driver.name || "Unknown Tool", version: driver.semanticVersion || driver.version || "" };

        let dateVal = run.invocations?.[0]?.endTimeUtc || run.invocations?.[0]?.startTimeUtc || sarif.time;
        state.reportDate = dateVal ? new Date(dateVal) : (state.fileLastModified ? new Date(state.fileLastModified) : new Date());

        const ruleMap = new Map();
        (driver.rules || []).forEach(rule => {
            let tags = rule.tags || rule.properties?.tags || [rule.properties?.category] || ["General"];
            ruleMap.set(rule.id, {
                name: rule.shortDescription?.text || rule.name || rule.id,
                categories: Array.isArray(tags) ? tags : ["General"],
                defaultLevel: rule.defaultConfiguration?.level || "warning"
            });
        });

        state.rawIssues = (run.results || []).map(result => {
            const ruleId = result.ruleId;
            const rd = ruleMap.get(ruleId) || { categories: ['Unknown'], name: ruleId };
            const loc = result.locations?.[0]?.physicalLocation;
            return {
                id: ruleId,
                name: rd.name,
                categories: rd.categories,
                message: result.message?.text || "No message",
                file: loc?.artifactLocation?.uri || "Unknown",
                line: loc?.region?.startLine || 0,
                level: result.level || rd.defaultLevel || "warning",
                snippet: loc?.contextRegion?.snippet?.text ? { text: loc.contextRegion.snippet.text, startLine: loc.contextRegion.startLine || 1 } : null,
                region: loc?.region || {}
            };
        });

        const uniqueCats = new Set();
        const uniqueIds = new Set();
        state.rawIssues.forEach(i => { uniqueIds.add(i.id); i.categories.forEach(c => uniqueCats.add(c)); });
        state.categories = uniqueCats;
        state.uniqueIssueIds = uniqueIds;
        renderCategoryPills();
        renderIssueIdPills();
        updateMetrics();
        applyFilters();
    }

    function showResultsUI() {
        dropZone.classList.add('hidden');
        resultsContainer.style.display = 'block';
        resetButton.classList.remove('hidden');
        const toolStr = `${state.driverInfo.name} ${state.driverInfo.version ? 'v' + state.driverInfo.version : ''}`;
        const dateStr = state.reportDate?.toLocaleString() || '';
        reportInfoContainer.innerHTML = `
            <div class="info-line-primary">${sanitize(state.filename)}</div>
            <div class="info-line-secondary">${sanitize(toolStr)}</div>
            <div class="info-line-tertiary" title="${sanitize(dateStr)}">${sanitize(dateStr)}</div>
        `;
    }

    function resetApp() {
        Object.assign(state, { rawIssues: [], filteredIssues: [], categories: new Set(), uniqueIssueIds: new Set(), filename: '', driverInfo: { name: '', version: '' }, reportDate: null, fileLastModified: null });
        state.filters = { text: '', categories: new Set(['all']), issueIds: new Set(['all']), severities: new Set(['all']) };
        dropZone.classList.remove('hidden');
        resultsContainer.style.display = 'none';
        resetButton.classList.add('hidden');
        reportInfoContainer.innerHTML = '';
        fileInput.value = ''; filterText.value = '';
        categoryPillsContainer.innerHTML = '<button class="pill active" data-value="all">All</button>';
        issueIdPillsContainer.innerHTML = '<button class="pill active" data-value="all">All</button>';
        updatePillVisuals(severityPillsContainer, state.filters.severities);
    }

    function renderCategoryPills() {
        categoryPillsContainer.innerHTML = '<button class="pill active" data-value="all">All</button>';
        Array.from(state.categories).sort().forEach(cat => {
            const p = document.createElement('button'); p.className = 'pill'; p.setAttribute('data-value', cat); p.textContent = cat; categoryPillsContainer.appendChild(p);
        });
    }

    function renderIssueIdPills() {
        issueIdPillsContainer.innerHTML = '<button class="pill active" data-value="all">All</button>';
        Array.from(state.uniqueIssueIds).sort().forEach(id => {
            const p = document.createElement('button'); p.className = 'pill'; p.setAttribute('data-value', id); p.textContent = id; issueIdPillsContainer.appendChild(p);
        });
    }

    function applyFilters() {
        const query = state.filters.text;
        const match = state.rawIssues.filter(i => i.id.toLowerCase().includes(query) || i.message.toLowerCase().includes(query) || i.file.toLowerCase().includes(query));
        updatePillCounts(match);
        state.filteredIssues = match.filter(i => {
            const lvl = (i.level || 'warning').toLowerCase();
            const sMatch = state.filters.severities.has('all') || (state.filters.severities.has('error') && lvl === 'error') || (state.filters.severities.has('warning') && lvl === 'warning') || (state.filters.severities.has('info') && (lvl === 'note' || lvl === 'none'));
            return sMatch && (state.filters.categories.has('all') || i.categories.some(c => state.filters.categories.has(c))) && (state.filters.issueIds.has('all') || state.filters.issueIds.has(i.id));
        });
        renderList();
    }

    function updatePillCounts(issues) {
        const counts = { cats: {}, ids: {}, sevs: { error: 0, warning: 0, info: 0 } };
        issues.forEach(i => {
            counts.ids[i.id] = (counts.ids[i.id] || 0) + 1;
            i.categories.forEach(c => counts.cats[c] = (counts.cats[c] || 0) + 1);
            const l = (i.level || 'warning').toLowerCase();
            if (l === 'error') counts.sevs.error++; else if (l === 'warning') counts.sevs.warning++; else counts.sevs.info++;
        });
        const update = (c, val, count, label) => {
            const p = c.querySelector(`[data-value="${val}"]`);
            if (p) { p.textContent = label ? `${label} (${count})` : `${val} (${count})`; if (count === 0 && val !== 'all') p.classList.add('hidden'); else p.classList.remove('hidden'); }
        };
        update(severityPillsContainer, 'error', counts.sevs.error, 'Error');
        update(severityPillsContainer, 'warning', counts.sevs.warning, 'Warning');
        update(severityPillsContainer, 'info', counts.sevs.info, 'Information');
        Array.from(state.categories).forEach(c => update(categoryPillsContainer, c, counts.cats[c] || 0));
        Array.from(state.uniqueIssueIds).forEach(id => update(issueIdPillsContainer, id, counts.ids[id] || 0));
    }

    function updateMetrics() {
        const issues = state.rawIssues;
        metricTotal.textContent = issues.length;
        metricErrors.textContent = issues.filter(i => i.level === 'error').length;
        metricWarnings.textContent = issues.filter(i => i.level === 'warning').length;
        metricInfo.textContent = issues.filter(i => i.level === 'note' || i.level === 'none').length;
        const cats = new Set(); issues.forEach(i => i.categories.forEach(c => cats.add(c)));
        metricCategories.textContent = cats.size;
    }

    function renderList() {
        issueList.innerHTML = '';
        if (state.filteredIssues.length === 0) return emptyFilterState.classList.remove('hidden');
        emptyFilterState.classList.add('hidden');

        const groups = {};
        state.filteredIssues.forEach(i => { if (!groups[i.id]) groups[i.id] = { id: i.id, categories: i.categories, instances: [] }; groups[i.id].instances.push(i); });

        const fragment = document.createDocumentFragment();
        Object.values(groups).sort((a, b) => a.id.localeCompare(b.id)).forEach(group => {
            const lvl = (group.instances[0].level || 'warning').toLowerCase();
            const sCls = lvl === 'error' ? 'severity-error' : (lvl === 'note' || lvl === 'none' ? 'severity-info' : 'severity-warning');
            const g = document.createElement('div'); g.className = 'issue-group';
            g.innerHTML = `
                <div class="issue-group-header">
                    <div class="issue-group-title" style="color: var(--${sCls})"><span class="severity-badge ${sCls}"></span>${sanitize(group.id)} <span class="issue-group-count">${group.instances.length}</span></div>
                    <div class="categories-wrapper">${group.categories.map(c => `<span class="category-badge">${sanitize(c)}</span>`).join('')}</div>
                </div>`;
            const content = document.createElement('div'); content.className = 'issue-group-content';
            group.instances.forEach(i => {
                let snippet = '';
                if (i.snippet) {
                    const lines = i.snippet.text.split('\n');
                    const lHtml = lines.map((text, idx) => {
                        const cur = i.snippet.startLine + idx;
                        let content = sanitize(text);
                        if (cur >= i.region.startLine && cur <= (i.region.endLine || i.region.startLine)) {
                            let start = cur === i.region.startLine ? Math.max(0, (i.region.startColumn || 1) - 1) : 0;
                            let end = cur === (i.region.endLine || i.region.startLine) && i.region.endColumn ? Math.min(text.length, i.region.endColumn - 1) : text.length;
                            content = `${sanitize(text.substring(0, start))}<span class="code-highlight">${sanitize(text.substring(start, end))}</span>${sanitize(text.substring(end))}`;
                        }
                        return `<div class="code-line"><span class="code-line-number">${cur}</span><span class="code-content">${content}</span></div>`;
                    }).join('');
                    snippet = `<div class="issue-code-snippet">${lHtml}</div>`;
                }
                const last = i.file.lastIndexOf('/');
                const card = document.createElement('div'); card.className = 'issue-card';
                card.innerHTML = `
                    <div class="issue-message"><span>${sanitize(i.message)}</span></div>
                    <button class="issue-location" data-path="${sanitize(i.file)}:${i.line}"><span class="path-dir">${sanitize(i.file.substring(0, last + 1))}</span><span class="path-name">${sanitize(i.file.substring(last + 1))}</span><span class="line-number">:${i.line}</span></button>
                    ${snippet}`;
                content.appendChild(card);
            });
            g.appendChild(content); fragment.appendChild(g);
        });
        issueList.appendChild(fragment);
    }
</script>
</body>
</html>